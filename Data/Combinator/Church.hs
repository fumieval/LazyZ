{-# LANGUAGE QuasiQuotes, FlexibleInstances #-}
module Data.Combinator.Church (encodeInteger) where

import Data.Combinator.Expr
import Language.LazyK.QQ
import qualified Data.Map as Map

encodeInteger n = case Map.lookup n churchNumerals of
    Just x -> x
    Nothing
        | mod n 2 == 0 -> n'
        | otherwise -> S :$ (S :$ (K :$ S) :$ K) :$ n'
    where
        n' = S :$ (K :$ (churchNumerals Map.! 2)) :$ encodeInteger (div n 2)

churchNumerals :: Map.Map Integer (Expr e)
churchNumerals = Map.fromList
    [
    (0,[cc|KI|])
    ,(1,[cc|I|])
    ,(2,[cc|S(S(KS)K)I|])
    ,(3,[cc|SS(SS(KI))(S(KS)K)|])
    ,(4,[cc|SII(S(S(KS)K)I)|])
    ,(5,[cc|SS(SSI(SS(KI)))(S(KS)K)|])
    ,(6,[cc|S(SSS)(SS(KI))(S(KS)K)|])
    ,(7,[cc|SS(S(SSS)(SS(KI)))(S(KS)K)|])
    ,(8,[cc|S(S(KS)(SS))I(SS(KI))(S(KS)K)|])
    ,(9,[cc|SS(SS)(SS(KI))(S(KS)K)|])
    ,(10,[cc|SS(SS(SS)(SS(KI)))(S(KS)K)|])
    ,(11,[cc|SS(SS(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(12,[cc|S(SSS)(SS(SS(KI)))(S(KS)K)|])
    ,(13,[cc|SS(S(SSS)(SS(SS(KI))))(S(KS)K)|])
    ,(14,[cc|SS(SS(S(SSS)(SS(SS(KI)))))(S(KS)K)|])
    ,(15,[cc|SS(SS(SS(S(SSS)(SS(SS(KI))))))(S(KS)K)|])
    ,(16,[cc|S(SII)I(S(S(KS)K)I)|])
    ,(17,[cc|SS(SS(SSI)(SS(KI)))(S(KS)K)(S(KS)K)|])
    ,(18,[cc|SS(SS(SS(SSI)(SS(KI))))(S(KS)K)|])
    ,(19,[cc|SS(SS(SS(SS(SSI)(SS(KI)))))(S(KS)K)|])
    ,(20,[cc|S(SSS)(SSI(SS(KI)))(S(KS)K)|])
    ,(21,[cc|SS(S(SSS)(SSI(SS(KI))))(S(KS)K)|])
    ,(22,[cc|SS(SS(S(SSS)(SSI(SS(KI)))))(S(KS)K)|])
    ,(23,[cc|SS(SS(SS(S(SSS)(SSI(SS(KI))))))(S(KS)K)|])
    ,(24,[cc|S(SI(SS(KI)))(S(SSS)(SS(SS(KI))))(S(KS)K)|])
    ,(25,[cc|S(SS(KI))(SS(SSI(SS(KI))))(S(KS)K)|])
    ,(26,[cc|SS(S(SS(KI))(SS(SSI(SS(KI)))))(S(KS)K)|])
    ,(27,[cc|SSI(SS(SS(KI)))(S(KS)K)|])
    ,(28,[cc|SS(SSI(SS(SS(KI))))(S(KS)K)|])
    ,(29,[cc|SS(SS(SSI(SS(SS(KI)))))(S(KS)K)|])
    ,(30,[cc|S(SSS)(SS(SSI(SS(KI))))(S(KS)K)|])
    ,(31,[cc|SS(S(SSS)(SS(SSI(SS(KI)))))(S(KS)K)|])
    ,(32,[cc|S(SS(SSI(SS(KI))))(SS(KI))(S(KS)K)|])
    ,(33,[cc|SS(S(SS(SSI(SS(KI))))(SS(KI)))(S(KS)K)|])
    ,(34,[cc|S(SI(SS(KI)))(SS(SS(SSI)(SS(KI))))(S(KS)K)|])
    ,(35,[cc|SS(S(SI(SS(KI)))(SS(SS(SSI)(SS(KI)))))(S(KS)K)|])
    ,(36,[cc|SS(S(SSS))(SS(KI))(S(KS)K)|])
    ,(37,[cc|SS(SS(S(SSS))(SS(KI)))(S(KS)K)|])
    ,(38,[cc|SS(SS(SS(S(SSS))(SS(KI))))(S(KS)K)|])
    ,(39,[cc|SS(SS(SS(SS(S(SSS))(SS(KI)))))(S(KS)K)|])
    ,(40,[cc|S(SI(SS(KI)))(S(SSS)(SSI(SS(KI))))(S(KS)K)|])
    ,(41,[cc|SS(S(SI(SS(KI)))(S(SSS)(SSI(SS(KI)))))(S(KS)K)|])
    ,(42,[cc|S(SSS)(S(SSS)(SS(KI)))(S(KS)K)|])
    ,(43,[cc|SS(S(SSS)(S(SSS)(SS(KI))))(S(KS)K)|])
    ,(44,[cc|SS(SS(S(SSS)(S(SSS)(SS(KI)))))(S(KS)K)|])
    ,(45,[cc|SS(SS(SS(S(SSS)(S(SSS)(SS(KI))))))(S(KS)K)|])
    ,(46,[cc|SS(SS(SS(SS(S(SSS)(S(SSS)(SS(KI)))))))(S(KS)K)|])
    ,(47,[cc|SS(SS(SS(SS(SS(S(SSS)(S(SSS)(SS(KI))))))))(S(KS)K)|])
    ,(48,[cc|S(SI(SS(SS(KI))))(SS(SSI)(SS(KI)))(S(KS)K)|])
    ,(49,[cc|S(SS(KI))(SS(S(SSS)(SS(KI))))(S(KS)K)|])
    ,(50,[cc|SS(S(SS(KI))(SS(S(SSS)(SS(KI)))))(S(KS)K)|])
    ,(51,[cc|SS(SS(S(SS(KI))(SS(S(SSS)(SS(KI))))))(S(KS)K)|])
    ,(52,[cc|SS(SS(SS(S(SS(KI))(SS(S(SSS)(SS(KI)))))))(S(KS)K)|])
    ,(53,[cc|SS(SS(SS(SS(S(SS(KI))(SS(S(SSS)(SS(KI))))))))(S(KS)K)|])
    ,(54,[cc|S(SI(SS(KI)))(SSI(SS(SS(KI))))(S(KS)K)|])
    ,(55,[cc|SS(S(SI(SS(KI)))(SSI(SS(SS(KI)))))(S(KS)K)|])
    ,(56,[cc|S(SSS)(SS(S(SSS)(SS(KI))))(S(KS)K)|])
    ,(57,[cc|SS(S(SSS)(SS(S(SSS)(SS(KI)))))(S(KS)K)|])
    ,(58,[cc|SS(SS(S(SSS)(SS(S(SSS)(SS(KI))))))(S(KS)K)|])
    ,(59,[cc|SS(SS(SS(S(SSS)(SS(S(SSS)(SS(KI)))))))(S(KS)K)|])
    ,(60,[cc|S(SI(SS(KI)))(S(SSS)(SS(SSI(SS(KI)))))(S(KS)K)|])
    ,(61,[cc|SS(S(SI(SS(KI)))(S(SSS)(SS(SSI(SS(KI))))))(S(KS)K)|])
    ,(62,[cc|S(SI(SS(KI)))(SS(S(SSS)(SS(SSI(SS(KI))))))(S(KS)K)|])
    ,(63,[cc|S(SI(SS(S(SSS)(SS(KI)))))(SS(SS)(SS(KI)))(S(KS)K)|])
    ,(64,[cc|S(S(SSS)(SS(KI)))(SS(KI))(S(KS)K)|])
    ,(65,[cc|SS(S(S(SSS)(SS(KI)))(SS(KI)))(S(KS)K)|])
    ,(66,[cc|SS(SS(S(S(SSS)(SS(KI)))(SS(KI))))(S(KS)K)|])
    ,(67,[cc|SS(SS(SS(S(S(SSS)(SS(KI)))(SS(KI)))))(S(KS)K)|])
    ,(68,[cc|S(SI(SSI(SS(KI))))(SS(SS(SSI)(SS(KI))))(S(KS)K)|])
    ,(69,[cc|SS(S(SI(SSI(SS(KI))))(SS(SS(SSI)(SS(KI)))))(S(KS)K)|])
    ,(70,[cc|S(SI(SS(S(SSS)(SS(KI)))))(SS(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(71,[cc|SS(S(SI(SS(S(SSS)(SS(KI)))))(SS(SS(SS)(SS(KI)))))(S(KS)K)|])
    ,(72,[cc|S(SSS)(S(S(KS)(SS))I(SS(KI)))(S(KS)K)|])
    ,(73,[cc|SS(S(SSS)(S(S(KS)(SS))I(SS(KI))))(S(KS)K)|])
    ,(74,[cc|S(SI(SS(KI)))(SS(SS(S(SSS))(SS(KI))))(S(KS)K)|])
    ,(75,[cc|SS(S(SI(SS(KI)))(SS(SS(S(SSS))(SS(KI)))))(S(KS)K)|])
    ,(76,[cc|S(SI(SS(KI)))(SS(SS(SS(S(SSS))(SS(KI)))))(S(KS)K)|])
    ,(77,[cc|SS(S(SI(SS(KI)))(SS(SS(SS(S(SSS))(SS(KI))))))(S(KS)K)|])
    ,(78,[cc|S(SI(SS(KI)))(SS(SS(SS(SS(S(SSS))(SS(KI))))))(S(KS)K)|])
    ,(79,[cc|SS(S(SI(SS(KI)))(SS(SS(SS(SS(S(SSS))(SS(KI)))))))(S(KS)K)|])
    ,(80,[cc|S(SI(SSI(SS(KI))))(S(SSS)(SSI(SS(KI))))(S(KS)K)|])
    ,(81,[cc|SS(SS(SS))(SS(KI))(S(KS)K)|])
    ,(82,[cc|SS(SS(SS(SS))(SS(KI)))(S(KS)K)|])
    ,(83,[cc|SS(SS(SS(SS(SS))(SS(KI))))(S(KS)K)|])
    ,(84,[cc|SS(SS(SS(SS(SS(SS))(SS(KI)))))(S(KS)K)|])
    ,(85,[cc|SS(SS(SS(SS(SS(SS(SS))(SS(KI))))))(S(KS)K)|])
    ,(86,[cc|SS(SS(SS(SS(SS(SS(SS(SS))(SS(KI)))))))(S(KS)K)|])
    ,(87,[cc|S(S(S(SSS)(SS(KI)))S)(SS(SS(SS))(SS(KI)))(S(KS)K)|])
    ,(88,[cc|S(S(S(SSS)(SS(KI)))S)(SS(SS(SS(SS))(SS(KI))))(S(KS)K)|])
    ,(89,[cc|S(S(S(S(KS)(SS))I(SS(KI)))S)(SS(SS(SS))(SS(KI)))(S(KS)K)|])
    ,(90,[cc|S(SSS)(SS(SS)(SS(KI)))(S(KS)K)|])
    ,(91,[cc|SS(S(SSS)(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(92,[cc|SS(SS(S(SSS)(SS(SS)(SS(KI)))))(S(KS)K)|])
    ,(93,[cc|SS(SS(SS(S(SSS)(SS(SS)(SS(KI))))))(S(KS)K)|])
    ,(94,[cc|SS(SS(SS(SS(S(SSS)(SS(SS)(SS(KI)))))))(S(KS)K)|])
    ,(95,[cc|SS(SS(SS(SS(SS(S(SSS)(SS(SS)(SS(KI))))))))(S(KS)K)|])
    ,(96,[cc|S(SI(S(SSS)(SS(KI))))(SS(SSI)(SS(KI)))(S(KS)K)|])
    ,(97,[cc|S(S(SS(SSI)(SS(KI)))S)(SS(SS(SS))(SS(KI)))(S(KS)K)|])
    ,(98,[cc|S(SI(SS(KI)))(S(SS(KI))(SS(S(SSS)(SS(KI)))))(S(KS)K)|])
    ,(99,[cc|S(S(SS(SS)(SS(KI)))S)(S(SSS)(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(100,[cc|S(SS(KI))(SS(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(101,[cc|SS(S(SS(KI))(SS(SS(SS)(SS(KI)))))(S(KS)K)|])
    ,(102,[cc|SS(SS(S(SS(KI))(SS(SS(SS)(SS(KI))))))(S(KS)K)|])
    ,(103,[cc|SS(SS(SS(S(SS(KI))(SS(SS(SS)(SS(KI)))))))(S(KS)K)|])
    ,(104,[cc|SS(SS(SS(SS(S(SS(KI))(SS(SS(SS)(SS(KI))))))))(S(KS)K)|])
    ,(105,[cc|S(SI(SS(SSI(SS(KI)))))(SS(S(SSS)(SSI(SS(KI)))))(S(KS)K)|])
    ,(106,[cc|S(S(SS(SSI)(SS(KI)))S)(S(SSS)(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(107,[cc|S(S(SS(SSI)(SS(KI)))S)(SS(S(SSS)(SS(SS)(SS(KI)))))(S(KS)K)|])
    ,(108,[cc|S(SI(SS(SS(KI))))(SS(S(SSS))(SS(KI)))(S(KS)K)|])
    ,(109,[cc|SS(S(SI(SS(SS(KI))))(SS(S(SSS))(SS(KI))))(S(KS)K)|])
    ,(110,[cc|S(SSS)(SS(SS(SS)(SS(KI))))(S(KS)K)|])
    ,(111,[cc|SS(S(SSS)(SS(SS(SS)(SS(KI)))))(S(KS)K)|])
    ,(112,[cc|SS(SS(S(SSS)(SS(SS(SS)(SS(KI))))))(S(KS)K)|])
    ,(113,[cc|SS(SS(SS(S(SSS)(SS(SS(SS)(SS(KI)))))))(S(KS)K)|])
    ,(114,[cc|SS(SS(SS(SS(S(SSS)(SS(SS(SS)(SS(KI))))))))(S(KS)K)|])
    ,(115,[cc|SS(SS(SS(SS(SS(S(SSS)(SS(SS(SS)(SS(KI)))))))))(S(KS)K)|])
    ,(116,[cc|S(SI(SSI(SS(KI))))(SS(SS(SSI(SS(SS(KI))))))(S(KS)K)|])
    ,(117,[cc|S(S(SS(S(SSS))(SS(KI)))S)(SS(SS(SS))(SS(KI)))(S(KS)K)|])
    ,(118,[cc|S(S(SS(S(SSS))(SS(KI)))S)(SS(SS(SS(SS))(SS(KI))))(S(KS)K)|])
    ,(119,[cc|S(SI(SS(S(SSS)(SS(KI)))))(SS(SS(SSI)(SS(KI))))(S(KS)K)|])
    ,(120,[cc|S(SI(S(SSS)(SS(KI))))(S(SSS)(SSI(SS(KI))))(S(KS)K)|])
    ,(121,[cc|S(SS(KI))(SS(SS(SS(SS)(SS(KI)))))(S(KS)K)|])
    ,(122,[cc|SS(S(SS(KI))(SS(SS(SS(SS)(SS(KI))))))(S(KS)K)|])
    ,(123,[cc|SS(SS(S(SS(KI))(SS(SS(SS(SS)(SS(KI)))))))(S(KS)K)|])
    ,(124,[cc|SS(SS(SS(S(SS(KI))(SS(SS(SS(SS)(SS(KI))))))))(S(KS)K)|])
    ,(125,[cc|S(SS(SS(KI)))(SS(SSI(SS(KI))))(S(KS)K)|])
    ,(126,[cc|SS(S(SS(SS(KI)))(SS(SSI(SS(KI)))))(S(KS)K)|])
    ,(127,[cc|SS(SS(S(SS(SS(KI)))(SS(SSI(SS(KI))))))(S(KS)K)|])
    ,(128,[cc|S(SS(S(SSS)(SS(KI))))(SS(KI))(S(KS)K)|])
    ,(256,[cc|SII|] :$ (churchNumerals Map.! 4))
    ]